# CSP451-Milestone-3
SmartRetail is a cloud-native inventory system using Azure Storage Queues, Dockerized Supplier API, and Azure Functions. It features event-driven messaging with correlation ID tracking for end-to-end traceability and monitoring via Azure Application Insights and Log Analytics.

# SmartRetail Inventory Coordination System
I chose Azure Storage Queue for event messaging due to its simplicity, reliability, and native integration with Azure Functions. It supports asynchronous communication and scales well for inventory event processing.

# Message Format and Flow 
The Supplier API expects order messages in JSON format with the following structure:
{
  "productId": "string",
  "name": "string",
  "stock": number,
  "correlationId": "string"
}
* productId: Unique product identifier
* name: Product name
* stock: Current stock quantity
* correlationId: Unique ID to trace the event across services

#Flow
* The backend service generates an order event with the above message format and sends it to the Azure Storage Queue (product-events).

* The Azure Function is triggered by new messages in the queue, extracts the event data including the correlation ID, and processes the order.

* The Azure Function forwards the order to the Supplier API via HTTP POST, passing along the correlation ID for traceability.

* The Supplier API receives the order, logs the details with the correlation ID, and returns a confirmation response.

* Logs from all components include the correlation ID, enabling end-to-end traceability and troubleshooting.

# Instructions to Deploy and Test
1. Deploy Backend Service
   * Set up and run backend service that publishes order events with correlation IDs to Azure Storage Queue (product-events)
     
2. Run Supplier API Docker Container
   * Build and run Supplier API Docker Container
    - docker build -t supplier-api .
    - docker run -d -p 4000:4000 supplier-api
   * Ensure the container is running and accessible.
     
3. Deploy Azure Function
   * Deploy the Azure Function with a trigger on the Azure Storage Queue (product-events).
   * Configure the function app settings and enviroment variables needed.

4. Configure Azure Storage Queue
   * Verify that the queue product-events exist in your Azure Storage account.
   * Ensure the backend service is configured to send messages to this queue.
  
# Testing
1. Send Test Order Event
   * Use the backend or REST client (Postman or curl) to send a sample order event with the required JSON format and correlation ID.

2. Verify Logs and Message Flow
   * Check the Azure Storage Queue to confirm the message was enqueued.
   * Confirm the Azure Function triggered and proccessed the message by viewing its logs in Azure Portal or Log Analytics.
   * Check the Supplier API logs or console output to verify it recieved the order with the correlation ID.
   * Optionally, use Azure Application Insights or Log Analytics to trace the full flow with correlation IDs.

3. Sample curl command
   *Example to send a POST request to Supplier API
 curl -X POST http://localhost:4000/order \
  -H "Content-Type: application/json" \
  -d '{
    "productId": "P123",
    "name": "Widget",
    "stock": 10,
    "correlationId": "test-001"
  }'

# Logs Demonstrating Correlation ID Traceability
Throughout the SmartRetail System, the unique correlation ID is included and logged at every stage to enable end-to-end traceability:
  * Backend Service:
      - Logs the emission of inventory events with the correlation ID, e.g.:
         Emitting event with correlationId: 3645052a-0143-4fe2-a214-2c4b13651806
  
  * Azure Function:
      - Logs processing of queue messages and includes the correlation ID, e.g.:
         Processing event with correlationId: 3645052a-0143-4fe2-a214-2c4b13651806

  * Supplier API:
      - Logs reciept of orders with correlation ID, e.g.:
        Received order with correlationId: 3645052a-0143-4fe2-a214-2c4b13651806

  * Azure Log Analytics:
      - Querying logs with correlation ID shows the complete transaction trace across all components, ensuring observability and easy troubleshooting.

  # The log messages are directly generated by source code, as shown in the uploaded index.js and Azure Function code, and verified by console and log Analytics screenshots. These examples illustrates how correlation IDs are propagated and logged throughout the system for traceability.

